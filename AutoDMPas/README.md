# AutoDMPas

**Фреймворк экспресс-моделирования сложных технических систем** на базе **Auto Data Model** (СПРУТ-ИСТА), реализованный на Delphi (Object Pascal).

Проект предоставляет комплексный инструментарий для быстрого создания, редактирования, анализа и сравнения моделей сложных технических систем. Включает визуальный редактор, пространственное моделирование, операции с элементами модели и поддержку транзакций.

## Структура проекта

### Основные компоненты

| Каталог | Описание |
|---------|----------|
| **DataModel** | COM-библиотека (DLL) — ядро объектной модели данных (IDataModel, коллекции, элементы, XML, работа с БД). Предоставляет базовую инфраструктуру для представления сложных технических систем в виде иерархических структур с поддержкой связей и атрибутов. |
| **DMEditor** | ActiveX-компонент (OCX) — визуальный редактор моделей технических систем (форма с контейнером, панели инструментов, меню, импорт растров/векторов, Undo/Redo, макросы). Основной инструмент для экспресс-моделирования. |
| **DMServer** | COM-сервер (DLL) — серверная модель данных (DataModelServer, DMDocument, транзакции, операции). Обеспечивает одновременную работу с несколькими документами (моделями). |
| **DMControls** | Модули управления и главная форма приложения (DMMainFrm, DMContainer, DMBrowser). Пользовательский интерфейс для работы с моделями технических систем. |

### Приложения

| Каталог | Описание |
|---------|----------|
| **DMCompare** | Программа **DMCompare** — сравнение двух моделей технических систем. Позволяет анализировать различия между версиями моделей или альтернативными вариантами проектирования. |
| **RegProj** | Утилита **RegProj** — регистрация и снятие регистрации COM-компонентов (DLL/OCX), управление списком файлов. Дополнительно: **CryptBin** — утилита для работы с бинарными данными. |

### Вспомогательные библиотеки

| Каталог | Описание |
|---------|----------|
| **DataModelPackage** | Реализация модели данных (DataModelU, DMElementU, MyDB, загрузка/сохранение, прогресс). |
| **DMCommon** | Общие типы и утилиты для DM. |
| **DMWin** | Обёртки для Windows/COM (DM_Windows, DM_ComObj, DM_ActiveX, DM_AxCtrls, DM_ComServ, DM_Messages). |
| **1stClass** | Набор визуальных компонентов (кнопки, панели, изображения, Outlook-бар и др.). |
| **PainterLib** | Библиотека отрисовки моделей технических систем (2D/3D визуализация, OpenGL-поддержка). |
| **SpatialModel** | Пространственная модель (SpatialModelLib) — расширение для работы с трёхмерными моделями технических систем: построение объёмов, стен, слоёв, операции с пространственными элементами. |
| **MyImageList** | Компоненты для работы со списками изображений (в т.ч. демо). |
| **VTreeView** | Древовидное представление модели. |
| **MkTypeLib** | Генерация type library. |
| **EZDSL** | Вспомогательные модули (например, EZDSLHsh). |

### Ресурсы в корне

- **AutoDM.tsl** / **AutoDM.tsr** — типовая библиотека и связанные ресурсы AutoDM (COM-интерфейсы для моделирования).
- **BuildFMVolumeOperationU.pas** — построение операций объёма для моделей сооружений (FM — Facility Model, модель сооружения).
- **DMDrawCursors1.res**, **DMDrawCursors2.res** — ресурсы курсоров отрисовки моделей.

## Сборка

Проект собирается в среде **Delphi** (используются `.dpr` — проекты библиотек и программ). Отдельных файлов решения (`.groupproj`) или проектов нового формата (`.dproj`) в репозитории нет.

1. Откройте нужный `.dpr` в Delphi (например, `DataModel\DataModel.dpr`, `DMControls\DMEditor.dpr`, `DMCompare\DMCompare.dpr`, `RegProj\RegProj.dpr`).
2. Убедитесь, что пути к модулям (DataModelPackage, DMCommon, DMWin, 1stClass и т.д.) заданы в настройках проекта или в общих путях IDE.
3. Выполните сборку (Build).

Порядок сборки зависимостей (если собираете с нуля): сначала библиотеки (DataModel, DMServer, PainterLib, SpatialModel, при необходимости MyImageList), затем DMEditor, затем приложения DMCompare и RegProj.

## Регистрация COM-компонентов

После сборки DLL и OCX их нужно зарегистрировать в системе. Можно использовать:

- Утилиту **RegProj** из каталога `RegProj`: пункты меню «Register» / «Unregister» для списка файлов.
- Стандартную регистрацию: `regsvr32.exe путь\к\DataModel.dll` и аналогично для DMEditor.ocx, DMServerLib.dll.

## Возможности фреймворка

### Экспресс-моделирование
- **Быстрое создание моделей** — визуальный редактор с интуитивным интерфейсом для построения моделей сложных технических систем
- **Импорт данных** — поддержка импорта растровых и векторных данных для использования в качестве основы моделирования
- **Макросы и автоматизация** — система макросов для ускорения повторяющихся операций моделирования

### Работа с моделями
- **Редактор моделей** — главная форма строится на базе `TfmDMMain` (DMControls), использует `IDMEditorX` и контейнер для создания/открытия/сохранения моделей, импорта растров и векторов, отмены/повтора, печати, макросов и т.д.
- **Пространственное моделирование** — работа с трёхмерными моделями через SpatialModel: построение объёмов, стен, слоёв, операции с пространственными элементами
- **Сравнение моделей** — приложение DMCompare (форма на базе `TfmDMMainCompare`) открывает две модели и сравнивает их через компаратор. Полезно для анализа различных вариантов проектирования или версий модели
- **Анализ моделей** — встроенный анализатор (IDMAnalyzer) для анализа моделей технических систем

### Серверная архитектура
- **Серверная модель** — DMServer предоставляет COM-интерфейсы для работы с документом и сервером модели (транзакции, операции)
- **Работа с несколькими документами** — поддержка одновременной работы с несколькими моделями (документами) через серверную архитектуру
- **Управление версиями** — транзакционная модель работы с возможностью сохранения и загрузки состояний

## Технологии

- **Язык:** Delphi (Object Pascal)  
- **Интерфейсы:** COM (IDataModel, IDMEditorX, DataModelServer, DMDocument, ISpatialModel и др.), Type Library (.tlb)  
- **Формы:** VCL (Forms, стандартные и кастомные компоненты из 1stClass и др.)  
- **Данные:** объектная модель с коллекциями, элементами, XML, загрузка/сохранение через БД (MyDB, RecordSet)
- **Визуализация:** библиотека отрисовки с поддержкой OpenGL для 2D/3D представления моделей технических систем
- **Пространственное моделирование:** трёхмерные операции, построение объёмов, работа со слоями и пространственными элементами


## Применение

Фреймворк AutoDMPas предназначен для:

- **Проектирования технических систем** — быстрое создание моделей сложных технических объектов и систем
- **Анализа и оптимизации** — сравнение вариантов проектирования, анализ структуры моделей
- **Документирования** — визуализация и печать моделей технических систем
- **Интеграции** — COM-интерфейсы позволяют интегрировать моделирование в другие приложения и системы

### Примеры применения

#### Моделирование систем физической защиты
Создание моделей комплексных систем физической защиты объектов: периметры, зоны контроля доступа, точки видеонаблюдения, системы сигнализации, барьеры и препятствия. Фреймворк позволяет визуализировать пространственную структуру системы защиты, анализировать зоны покрытия и оптимизировать размещение элементов защиты.

#### Моделирование систем радиационного контроля
Построение моделей систем радиационного мониторинга и контроля: размещение датчиков радиационного контроля, зоны мониторинга, маршруты перемещения источников излучения, анализ уровней радиационного фона. Пространственное моделирование помогает оптимизировать расположение контрольных точек и оценить эффективность системы мониторинга.

#### Моделирование логистики
Создание моделей логистических систем: складские комплексы, транспортные маршруты, зоны погрузки/разгрузки, потоки материалов и товаров. Фреймворк позволяет моделировать пространственную структуру логистических объектов, анализировать пропускную способность и оптимизировать логистические процессы.

#### Отображение судоходной обстановки в мировом океане
Визуализация и моделирование судоходной обстановки в глобальном масштабе: позиции судов, морские пути, порты и терминалы, метеорологические данные, зоны ответственности береговых служб. Пространственное моделирование позволяет отображать динамическую обстановку на картах мирового океана.

